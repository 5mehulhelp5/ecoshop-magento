<?php
$is_enable    = $block->getEnabled();
$title        = $block->getTitle();
$sub_title    = $block->getSubtitle();
$advertisement_id = $block->getUniqueCode() ? $block->getIdByUniqueCode($block->getUniqueCode()) : $block->getAdvertisement();

$spacing_class = '';
$custom_class  = $this->getData('wd_custom_class') ?: '';
$spacing_class .= $this->getData('wd_spacing') ? 'sections-spacing ' : '';
$spacing_class .= $this->getData('wd_bottom_spacing') ? 'section-bottom-spacing' : '';
$icon = $this->getData('wd_btn_icon')?: '';
$adv_style           = $block->getStyle();
$helper              = $this->helper('\Magebees\Advertisementblock\Helper\Data');
$resizes_img_dir     = $helper->getResizedImgDir();
$img_dir             = $helper->getImageMediaDir();
$advertise_info      = $helper->getAdvertiseBlockdetail($advertisement_id);
$pattern_div_arr     = ['13', '14', '16', '17', '21', '26', '28', '32'];
$three_col_pattern_arr = ['13', '14', '21', '26', '28'];
$two_col_pattern_arr = ['16', '17', '32'];
$img_divarr          = $helper->getPatternImgDiv();
$parentDivarr        = $helper->getColumnParentDiv();
$patternImageSize    = $helper->getPatternImageSize();
?>

<?php
$poco_helper     = $this->helper('Magebees\PocoThemes\Helper\Data');
$home_style      = $poco_helper->getHome('home_style', $poco_helper->getStoreId());
$storeId         = $poco_helper->getStoreId();
$animation       = $poco_helper->getThemeLayout('animation', $storeId) ? true : false;
$animation_class = $animation ? "wow animate__fadeIn" : " ";
?>

<?php if (isset($advertise_info[0])): ?>
    <?php
    $adv_data = $advertise_info[0];
    $status   = $adv_data['status'];
    $pattern  = $adv_data['pattern'];
    ?>

    <?php if ($is_enable && $status): ?>
        <div class="advertisement-block <?php echo $custom_class; ?> <?php echo $spacing_class ?> <?php echo $animation_class ?>" <?php if ($animation): ?> data-wow-delay="0.2s" <?php endif; ?>>
            <div class="container">
                <div class="maagebees-add">

                    <?php if ($title): ?>
                        <div class="section-title">
                            <h2 class="title"><?php echo $title; ?></h2>
                            <?php if ($sub_title): ?>
                                <div class="sort-details">
                                    <p class="sort-detail"><?php echo $sub_title; ?></p>
                                </div>
                            <?php endif; ?>
                        </div>
                    <?php endif; ?>

                    <div class="mageb-patn-inner">
                        <?php
                        $style_class = ($pattern == 1 && $adv_style == 1) ? 'full-width' : 'boxed';
                        if (in_array($pattern, $pattern_div_arr)):
                            $col_class = in_array($pattern, $three_col_pattern_arr) ? 'mageb-three-col clearfix' : 'mageb-two-col clearfix';
                        ?>
                            <div class="mageb-patterns mageb-pattern<?php echo $pattern; ?> <?php echo $col_class; ?>">
                        <?php else: ?>
                            <ul class="mageb-patterns mageb-pattern<?php echo $pattern; ?> <?php if ($pattern == 1) echo $style_class; ?>">
                        <?php endif; ?>

                        <?php $advertise_img_detail = $helper->getAdvertiseImagedetail($advertisement_id); ?>
                        <?php if ($advertise_img_detail): ?>
                            <?php $i = -1; ?>
                            <?php foreach ($advertise_img_detail as $advertise): ?>
                                <?php
                                $i++;
                                $img_url = $advertise['exteranl_url'] == 1
                                    ? $advertise['advertise_url']
                                    : $this->getStoreObj()->getStore()->getBaseUrl() . $advertise['advertise_url'];

                                $img_path = ($pattern == 1 && $adv_style == 1)
                                    ? $img_dir . $advertise['filename']
                                    : $resizes_img_dir . $advertise['filename'];

                                $height = $advertise['image_height'];
                                $width = $advertise['image_width'];
                                $effect = $advertise['image_effect'];

                                $img_classes = $img_divarr[$pattern] ?? [];
                                $parent_div = $parentDivarr[$pattern] ?? [];
                                ?>

                                <?php if (in_array($pattern, $pattern_div_arr)): ?>
                                    <?php
                                    for ($j = 0; $j < 3; $j++) {
                                        if (isset($parent_div[$j])) {
                                            $add_div_arr = explode(",", $parent_div[$j][0]);
                                            if ($i == current($add_div_arr)) {
                                                echo '<div class="' . $parent_div[$j][1] . '">';
                                            }
                                        }
                                    }
                                    ?>
                                    <div class="mageb-pattern-list mageb-<?php echo $effect; ?> <?php echo $img_classes[$i]; ?>">
                                <?php else: ?>
                                    <li class="mageb-pattern-list mageb-<?php echo $effect; ?>">
                                <?php endif; ?>

                                    <div class="mageb-effects">
                                        <?php if ($advertise['show_image'] && $advertise['filename']): ?>
                                            <a href="<?php echo $img_url; ?>" <?php if ($advertise['exteranl_url'] == 1): ?>target="_blank"<?php endif; ?>>
                                                <img src="<?php echo $img_path; ?>" alt="<?php echo __(strip_tags($advertise['hover_heading_text'])); ?>" title="<?php echo __(strip_tags($advertise['hover_heading_text'])); ?>" <?php if ($width): ?> width="<?php echo $width; ?>"<?php endif; ?> <?php if ($height): ?> height="<?php echo $height; ?>"<?php endif; ?> />
                                            </a>
                                        <?php else: ?>
                                            <?php
                                            $bg_color = $advertise['bg_color'] ?: '#ffffff';
                                            $img_dim_arr = explode('*', $patternImageSize[$pattern][$i]);
                                            ?>
                                            <div style="background-color:<?php echo $bg_color; ?>; height:<?php echo $img_dim_arr[1] . 'px'; ?>; width:<?php echo $img_dim_arr[0] . 'px'; ?>;" title="<?php echo __(html_entity_decode($advertise['hover_heading_text'])); ?>"></div>
                                        <?php endif; ?>
                                    </div>

                                    <?php if ($advertise['show_hover_heading_text'] || $advertise['show_hover_short_text'] || $advertise['show_button_text']): ?>
                                        <div class="mageb-caption <?php echo ($advertise['text_position'] == '0' ? "v-top" : ($advertise['text_position'] == '1' ? "v-middle" : "v-bottom")); ?> <?php echo ($advertise['display_text_mode'] == '0' ? "mageb-on-hover-caption" : "mageb-on-load-caption"); ?>">
                                            <div class="mageb-full-caption">
                                                <div class="text">
                                                    <?php if ($advertise['hover_heading_text']): ?>
                                                        <div class="h4">
                                                            <a href="<?php echo $img_url; ?>" style="color:<?php echo $advertise['heading_text_color']; ?>; font-size:<?php echo $advertise['heading_text_size']; ?>;">
                                                                <?php echo __(html_entity_decode($advertise['hover_heading_text'])); ?>
                                                            </a>
                                                        </div>
                                                    <?php endif; ?>
                                                    <?php if ($advertise['show_hover_short_text'] && $advertise['hover_short_text']): ?>
                                                        <div class="sort-text" style="color:<?php echo $advertise['short_text_color']; ?>; font-size:<?php echo $advertise['short_text_size']; ?>;">
                                                            <?php echo __(html_entity_decode($advertise['hover_short_text'])); ?>
                                                        </div>
                                                    <?php endif; ?>
                                                </div>

                                                <?php if ($advertise['show_button_text'] && $advertise['button_text']): ?>
                                                    <a href="<?php echo $img_url; ?>" title="<?php echo __(html_entity_decode($advertise['button_text'])); ?>" rel="nofollow" class="button" <?php if ($advertise['exteranl_url'] == 1): ?>target="_blank"<?php endif; ?> style="color:<?php echo $advertise['button_text_color']; ?>; font-size:<?php echo $advertise['button_text_size']; ?>; background-color:<?php echo $advertise['button_bg_color']; ?>;">
                                                        <span class="b-text"><?php echo __(html_entity_decode($advertise['button_text'])); ?></span>
                                                        <span class="b-icon">
															<?php if($icon): ?>
															<?php echo __(html_entity_decode($icon)); ?>
															<?php else: ?>
																<svg xmlns="https://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="st-icon">                                                                 <line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
																
																
																
																
															<?php endif; ?>
                                                            
                                                        </span>
                                                    </a>
                                                <?php endif; ?>
                                            </div>
                                        </div>
                                    <?php endif; ?>

                                <?php if (in_array($pattern, $pattern_div_arr)): ?>
                                    </div>
                                    <?php
                                    for ($j = 0; $j < 3; $j++) {
                                        if (isset($parent_div[$j])) {
                                            $add_div_arr = explode(",", $parent_div[$j][0]);
                                            if ($i == end($add_div_arr)) {
                                                echo '</div>';
                                            }
                                        }
                                    }
                                    ?>
                                <?php else: ?>
                                    </li>
                                <?php endif; ?>
                            <?php endforeach; ?>

                        <?php if (in_array($pattern, $pattern_div_arr)): ?>
                            </div>
                        <?php else: ?>
                            </ul>
                        <?php endif; ?>
                        <?php endif; ?>
                    </div>
                </div>
            </div>
        </div>
    <?php endif; ?>
<?php endif; ?>
